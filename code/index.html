<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/mode/javascript/javascript.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/ambiance.min.css" integrity="sha512-wVrMpCao81zIdzAM+fYyuF6BoUXjDO8le2mQXl4iVezdDSgZOCFtpm/AL3LZn9dqc3e4CloZfiZxhTp5UNpWIw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
    <title>JavaScript Code Runner</title>
  </head>
  <body>
    <!-- Main Style -->
    <style>
      html, body {
        width: 100dvw;
        height: 100dvh;
        margin: 0;
        padding: 0;
        background: #202020;
        color: #eee;
        --code-box-shadow: #0e0e0e;
      }

      .input {
        user-select: none;
        flex-grow: 1;
        overflow: hidden;
      }

      body {
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .CodeMirror {
        width: 100%;
        height: 100%;
      }

      .buttons {
        display: flex;
        flex-wrap: wrap;
      }

      .button {
        font-size: 0.8em;
        margin: 0.2em;
        background: #424242;
        padding: 0.3em;
        cursor: pointer;
        user-select: none;
        width: max-content;
        white-space: nowrap;
      }
      .button:hover {
        background: #525252;
      }
      .button:active {
        background: #363636;
      }

      .output {
        display: block;
        margin: 0.2em 0;
        width: 100%;
        font-family: Consolas, "Courier New", monospace;     
        background: #1e1e1e;
        height: 40dvh;
        min-height: 1.5em;
        overflow-y: auto;
        position: relative;
      }
      .output > p {
        margin-top: 0;
        margin-bottom: 0.2em;
        padding: 3px;
      }
      
      .resize-bar {
        display: block;
        width: 100%;
        height: 6px;
        position: relative;
        cursor: ns-resize;
      }
      .resize-bar:hover {
        background: #2e6289;
      }

      :is(.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .output)::-webkit-scrollbar {
        background: #212121;
        width: min(12px, 3dvw);
        height: min(12px, 3dvw);
      }
      :is(.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .output)::-webkit-scrollbar-thumb {
        background: #363636;
        min-height: min(20%, 1.5em);
      }
      :is(.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .output)::-webkit-scrollbar-thumb:hover {
        background: #3e3e3e;
      }
      :is(.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .output)::-webkit-scrollbar-thumb:active {
        background: #313131;
      }
    </style>
    <!-- Ambiance Style Overrides -->
    <style>
      .cm-s-ambiance.CodeMirror {
        color: #e6e1dc;
        background-color: #202020;
        box-shadow: inset 0 0 10px var(--code-box-shadow);
      }

      .cm-s-ambiance .CodeMirror-gutters {
        background: #252425;
        border-right: 1px solid #4d4d4d;
        box-shadow: 0 10px 20px var(--code-box-shadow);
      }

      .cm-s-ambiance .CodeMirror-linenumber {
        text-shadow: 0 1px 1px #4d4d4d;
        color: #aaaaaa;
        padding: 0 5px;
      } 

      .cm-s-ambiance .cm-operator {
        color: #eb5a25;
      }

      .cm-s-ambiance .cm-comment {
        color: #9d9d9d;
      }
    </style>
    <!-- VSCode Style -->
    <style>
      /**
       *	@package    vscode-dark theme
       *	@version    1.0.0
       *	@author		  Inter-Net PRO
       *	@link       https://inter-net.pro
       *	@github     https://github.com/Inter-Net-Pro/Theme-VSCode-Dark
       */
      
      .cm-s-vscode-dark span.cm-meta {
        color: #569cd6
      }

      .cm-s-vscode-dark span.cm-number {
        color: #b5cea8
      }

      .cm-s-vscode-dark span.cm-keyword {
        line-height: 1em;
        font-weight: bold;
        color: #569cd6;
      }

      .cm-s-vscode-dark span.cm-def {
        color: #9cdcfe
      }

      .cm-s-vscode-dark span.cm-variable {
        color: #ddd6a3
      }

      .cm-s-vscode-dark span.cm-variable-2 {
        color: #9cdcfe
      }

      .cm-s-vscode-dark span.cm-variable-3,
      .cm-s-vscode-dark span.cm-type {
        color: #A9B7C6
      }

      .cm-s-vscode-dark span.cm-property {
        color: #9cdcfe
      }

      .cm-s-vscode-dark span.cm-operator {
        color: #d4d4d4
      }

      .cm-s-vscode-dark span.cm-string {
        color: #ce9178
      }

      .cm-s-vscode-dark span.cm-string-2 {
        color: #6A8759
      }

      .cm-s-vscode-dark span.cm-comment {
        color: #6A9955
      }

      .cm-s-vscode-dark span.cm-link {
        color: #287BDE
      }

      .cm-s-vscode-dark span.cm-atom {
        color: #569cd6
      }

      .cm-s-vscode-dark span.cm-error {
        color: #BC3F3C
      }

      .cm-s-vscode-dark span.cm-tag {
        color: #569cd6
      }

      .cm-s-vscode-dark span.cm-attribute {
        color: #9cdcfe
      }

      .cm-s-vscode-dark span.cm-qualifier {
        color: #d7ba7d
      }

      .cm-s-vscode-dark span.cm-bracket {
        color: #808080
      }

      .cm-s-vscode-dark.CodeMirror {
        background: #1e1e1e;
        color: #e9e9e9;
      }

      .cm-s-vscode-dark .CodeMirror-cursor {
        border-left: 1px solid #bebebe;
      }

      .CodeMirror-activeline-background {
        background: #3A3A3A;
      }

      .cm-s-vscode-dark div.CodeMirror-selected {
        background: #1e496c
      }

      .cm-s-vscode-dark .CodeMirror-gutters {
        background: #252526;
        border-right: 1px solid grey;
        color: #606366
      }

      .cm-s-vscode-dark span.cm-builtin {
        color: #A9B7C6;
      }

      .cm-s-vscode-dark {
        font-family: Consolas, "Courier New", monospace, serif;
      }

      .cm-s-vscode-dark .CodeMirror-matchingbracket {
        background-color: #3b514d;
        color: yellow !important;
      }

      .CodeMirror-hints.vscode-dark {
        font-family: Consolas, "Courier New", monospace;
        color: #9c9e9e;
        background-color: #3b3e3f !important;
      }

      .CodeMirror-hints.vscode-dark .CodeMirror-hint-active {
        background-color: #494d4e !important;
        color: #9c9e9e !important;
      }
    </style>

    <div class="input">
      <textarea id="code"></textarea>
    </div>

    <div class="buttons">
      <div class="button" onclick="_run__GGLxgJAvktbGb9Dj();">Run</div>
      <div class="button open" onclick="
        const selection = window.getSelection()
        const urlElement = document.querySelector('.output');
        urlElement.innerHTML = window.location.href;
        selection.setBaseAndExtent(urlElement, 0, urlElement, 1);
      ">Show URL</div>
      <div class="button dev-only" onclick="__encode__PGN65KDTftoGOAE0();">Generate URL</div>
      <div class="button dev-only" onclick="__clear__swSZHb3Rb70hcw6M();">Clear URL</div>
      <div class="button dev-only" onclick="__iframe__ww9XHLHuf2DpfLnH();">Copy iframe</div>
    </div>

    <div class="resize-bar"></div>
    <div class="output" onscroll="_handleScroll__bCwy7OEEAuV4dy9I();"></div>

    <script>
      var _editor__GjDwVna4MtH9GIXx;

      document.addEventListener("DOMContentLoaded", function () {
        _editor__GjDwVna4MtH9GIXx = CodeMirror.fromTextArea(document.getElementById("code"), {
          lineNumbers: true,
          mode: "javascript",
          theme: "vscode-dark" // "ambiance"
        });

        var _urlParams__tRGBVj2tihRgyN8H = new URLSearchParams(window.location.search);
        const _codeContent__6kdBN6Duonkqzz32 = _urlParams__tRGBVj2tihRgyN8H.get("content");
        const _devMode__mUGOb2lsXCIE6Mtw     = _urlParams__tRGBVj2tihRgyN8H.get("dev") ? true : false;
        
        _editor__GjDwVna4MtH9GIXx.setValue(_codeContent__6kdBN6Duonkqzz32 ?? "// Enter your JavaScript code here...");

        if (!_devMode__mUGOb2lsXCIE6Mtw) {
          for (let secretElement of document.querySelectorAll(".dev-only")) {
            secretElement.style["display"] = "none";
          }
        }
      });

      var _outputs__NRtC65XME5PsJY1m = [];

      function _write__0fKbbRq3wDQT3vEf(output) {
        _outputs__NRtC65XME5PsJY1m.push(
          output
            .replaceAll(/\r\n|\r|\n/g, "</p><p>")
            .replaceAll(/ /g, "&nbsp;")
        );
      }

      function _run__GGLxgJAvktbGb9Dj() {
        document.querySelector(".output").innerHTML = "";
        window.requestAnimationFrame(() => {
          window.requestAnimationFrame(___run__GGLxgJAvktbGb9Dj__hzi08Y03uLgVrqIF);
        });
      }
      function ___run__GGLxgJAvktbGb9Dj__hzi08Y03uLgVrqIF() {
        let code = _editor__GjDwVna4MtH9GIXx.getValue();

        // Capture standard output and error streams
        var _originalConsoleLog__SteHgoGLQ4TV6MNr = console.log;
        var _originalConsoleError__o6dbbb8dB2ViRemx = console.error;

        // for (let key of Object.keys(console)) {
        //   if (console.hasOwnProperty(key)) {
        //     
        //   }
        // }

        console.log = function (...messages) {
          _write__0fKbbRq3wDQT3vEf(`<p>${messages.map(v => "" + v).join(" ")}</p>`);
          // _originalConsoleLog__SteHgoGLQ4TV6MNr.apply(console, arguments);
        };

        console.error = function (error) {
          _write__0fKbbRq3wDQT3vEf(`<p>Error: <span class="error">${error}</span></p>`);
          // _originalConsoleError__o6dbbb8dB2ViRemx.apply(console, arguments);
        };

        try {
          // Run the code
          eval(code);
        } 
        catch (error) {
          // Handle any exceptions
          console.error(error.message);
        } 
        finally {
          // Restore the original console.log, console.error, and prompt
          console.log = _originalConsoleLog__SteHgoGLQ4TV6MNr;
          console.error = _originalConsoleError__o6dbbb8dB2ViRemx;
        }
      }

      function __encode__PGN65KDTftoGOAE0() {
        let url = `${window.location.href.split("?")[0]}?content=${encodeURIComponent(_editor__GjDwVna4MtH9GIXx.getValue())}`;
        // navigator.clipboard._write__0fKbbRq3wDQT3vEfText(`<iframe allow="modal" src="${url}"></iframe>`);
        window.open(url, "_blank");
      }

      function __iframe__ww9XHLHuf2DpfLnH() {
        let url = `${window.location.href.split("?")[0]}?content=${encodeURIComponent(_editor__GjDwVna4MtH9GIXx.getValue())}`;
        navigator.clipboard._write__0fKbbRq3wDQT3vEfText(`<iframe allow="modal" src="${url}"></iframe>`);
      }

      function __clear__swSZHb3Rb70hcw6M() {
        if (confirm("Clear URL will also clear your code too!"))
          window.location.assign(`${window.location.pathname}?dev=true`);
      }

      function _updateFrame__FCfxKTcRE2Yt5kxm() {
        if (_outputs__NRtC65XME5PsJY1m.length) {
          var outputDiv = document.querySelector(".output");

          // outputDiv.innerHTML += _outputs__NRtC65XME5PsJY1m.shift();
          outputDiv.innerHTML += _outputs__NRtC65XME5PsJY1m.slice(0, 10).join("");
          _outputs__NRtC65XME5PsJY1m.splice(0, 10);

          if (_scrollToBottom__T9qsIEYL0h8ob1dT) {
            outputDiv.scrollTop = outputDiv.scrollHeight;
          }
        }

        window.requestAnimationFrame(_updateFrame__FCfxKTcRE2Yt5kxm);
      }
      window.requestAnimationFrame(_updateFrame__FCfxKTcRE2Yt5kxm);

      var _scrollToBottom__T9qsIEYL0h8ob1dT = true;

      function _handleScroll__bCwy7OEEAuV4dy9I() {
        _scrollToBottom__T9qsIEYL0h8ob1dT = false;

        var outputDiv = document.querySelector(".output");
        if (Math.abs(outputDiv.scrollHeight - outputDiv.scrollTop - outputDiv.clientHeight) < 100) {
          _scrollToBottom__T9qsIEYL0h8ob1dT = true;
        }
      }
      
      if (window.location.host === window.parent.location.host)  {
        document.querySelector(".button.open").style['display'] = 'none';
      }
      else {
        document.querySelector(".output").style.height = "4em";
      }

      var _resizer__ZQRQVrerUMGCe95k = {
        target: document.querySelector(".output"),
        mouse: {
          y: -1,
          pressed: false,
          locked: false
        }
      };

      window.addEventListener("mousedown", () => {
        if (Math.abs(_resizer__ZQRQVrerUMGCe95k.mouse.y - _resizer__ZQRQVrerUMGCe95k.target.offsetTop) < 10) {
          _resizer__ZQRQVrerUMGCe95k.mouse.pressed = true;
        }
        else {
          _resizer__ZQRQVrerUMGCe95k.mouse.locked = true;
        }
      });
      window.addEventListener("mouseup", () => {
        _resizer__ZQRQVrerUMGCe95k.mouse.pressed = false;
        _resizer__ZQRQVrerUMGCe95k.mouse.locked = false;
      });

      window.addEventListener("mousemove", (ev) => {
        window.requestAnimationFrame(() => {
          _resizer__ZQRQVrerUMGCe95k.mouse.y = ev.clientY;

          if (_resizer__ZQRQVrerUMGCe95k.mouse.pressed) {
            ev.preventDefault();

            _resizer__ZQRQVrerUMGCe95k.target.style["height"] = `${window.innerHeight - _resizer__ZQRQVrerUMGCe95k.mouse.y - 12}px`;

            document.body.style.cursor = "ns-resize";
            document.querySelector(".resize-bar").style.background = "#2e6289";
          }
          else {
            document.body.style.cursor = null;
            document.querySelector(".resize-bar").style.background = null;
          }
        });
      });
    </script>
  </body>
</html>
